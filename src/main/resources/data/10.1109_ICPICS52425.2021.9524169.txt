Research and Application of MES Technology Architecture in Tobacco Industry Based on Microservice
Wenlong Jin, Jie Qian, Qingsong Zhang, Xuefeng Gao, Yuangen Xu

Ningbo Cigarette Factory, China Tobacco Zhejiang Industrial Co. Ltd., Ningbo, China


Abstract
At present, tobacco enterprises have basically built MES systems. With the large-scale popularization and application of the Internet of Things, big data, industrial cloud, and artificial intelligence technology, the original system technology architecture cannot be compatible with the latest information technology, so it needs to be upgraded. Microservice technology architecture is the most advanced information system technology architecture at present. This paper explores the microservice transformation design of MES system technology architecture, in order to keep up with the development of information technology and better improve the intelligent level of tobacco enterprises.

Keywords
Micro service architecture, MES, cigarette production, intelligent manufacturing

I. INTRODUCTION
The information construction of cigarette enterprises is based on the goal of "Digital Tobacco" in the tobacco industry integration. Through the integration of information technology, automation technology, manufacturing technology, and modern management technology, we can build a "fine," "visual," and "intelligent" intelligent factory. The design and transformation of MES technology architecture based on microservice is the best means to explore the application of the latest information technology, continuously improve the level of manufacturing information and intelligence, and timely respond to the intelligent needs of the tobacco industry. The design of microservice technology architecture can be divided into data storage layer design, data access layer design, microservice business layer design, and display layer design. Through the new microservice architecture, the stability, timeliness, and adaptability of the MES information system are greatly improved, and advanced technologies such as big data, Internet of Things, and industrial cloud are integrated to serve the intelligent manufacturing of cigarette enterprises. This improves the production efficiency of the cigarette workshop, reduces production costs, improves the quality of poor products, and responds to market demand timely.

II. OVERVIEW
With the development of current technology and business, AI and big data applications appear, and the traditional MES system monomer architecture has been unable to support the existing application requirements and the future development needs of the system. The new microservice technology architecture can meet the following new requirements:

Service independence, no impact on each other
Service can be deployed and run independently, and different technology selection can be available in different contexts
High performance and high concurrency
The interface can respond to requests quickly and process business queues to support large concurrency
Event traceability and final consistency
The historical change state of the object can be tracked, and the object can be traced back to any state
High availability of services
Architecture elasticity
Strong scalability
Based on the independence and low coupling of microservices, whether it is function or architecture, it can be expanded more flexibly without affecting other services.

III. DESIGN PRINCIPLES
The technical principles of MES technology architecture design based on microservice are as follows:

Economic principle: The construction of the system must adhere to the existing software and hardware facilities, make full use of the existing network resources, hardware equipment, software, human resources, and data resources, fully consider the relationship between economy and cost, select high cost-effective architecture technology, and try to use mature open-source products to maximize the interests of enterprises.

Advanced and mature principles: All the elements of the system should fully consider the advanced nature of its technology. Only by absorbing the successful experience of related system construction at home and abroad, combining the world's advanced and promising technology with practical application, and adopting the current advanced and mature technology and equipment. The development or configuration of advanced, efficient, and practical system software and application software ensures that the system is established at a higher starting point, so that the whole system can run in a coordinated manner, in order to obtain the maximum system performance and benefits.

Principle of reliability and stability: The system should have high reliability, be able to better adapt to the working environment and use needs of cigarette production points, and ensure that the system will not collapse during normal production time. At the same time, the system should have high availability, be able to recover in a short time when the system has problems, and provide a perfect and reliable data backup mechanism to ensure data completeness and consistency.

The principle of integration: MES has a complete range of functions covering all aspects of the production organization and needs to integrate with a large number of information systems. It must strictly follow the existing integration specifications, implement the integrated digital requirements of intelligent management and control, consider the integration and collaboration among all subsystems as a whole, and realize integrated information sharing with different systems outside and inside the plant.

Flexibility principle: Information system is the mapping set of management ideas and business processes. With the continuous evolution of business and the continuous development of computer technology, the platform is required to adapt to this change with enough flexibility, faster implementation speed, more convenient customization function, and less system maintenance cost. In the aspect of application system design and development, we should follow international or industry standards, according to standardized and modular design ideas, and build a flexible and open application support platform.

Principle of easy management: The interface is friendly and unified, fully considering the characteristics of operators, making the data processing simple, convenient, and fast. Clear business processes should align with routine business processing habits. The system is specially designed for users with different levels of computer knowledge, making it easy to operate and use.

Principles of openness and standardization: Based on the MES functional model defined in ISA-95 standard, the standard functions of the system are designed in combination with domestic tobacco industry and enterprise standards. In terms of technical implementation, mature commercial software platforms and supporting products that follow the microservice platform architecture, modularization, and componentization are adopted to standardize the data integration standards between application systems, reduce coupling with surrounding systems, and promote the demonstration and popularization of the results.

Normative principle: It conforms to international and domestic management requirements, specifications, laws and regulations of electronic documents, archives and data, as well as the requirements and specifications of ISO9000 quality management system or CMMI software maturity management system. The development of the system should follow the whole process from requirement analysis, outline design, detailed design, coding, system testing to formal operation, follow the requirements of software engineering specifications, and provide detailed development documents for record and secondary development.

Principles of security and confidentiality: Security is an important principle in the construction of procurement systems. While the overall design and system integration are carried out, unified and complete consideration should be given to security and reliability. There should be a perfect and thorough security system with secure and reliable encryption means and methods. Strict identity verification, access control, digital certificates, digital signatures, and multi-level confidentiality measures should be used.

IV. DATA STORAGE LAYER DESIGN
The design of data storage layer adopts the combination mode of HDFS + Oracle + MongoDB, and uses the distributed file system HDFS as the temporary storage of clusters and services. HDFS has high fault tolerance characteristics and is designed to be deployed on low-cost hardware. HDFS provides high throughput to access application data, suitable for the needs of big data access and AI in future applications. In terms of business data storage, Oracle database is widely used in large projects at home and abroad, meeting many principles and requirements of database selection, and has advantages of stability, easy development, strong function, easy management, security, and scalability. To ensure efficient access and security of structural data, the project adopts MongoDB database based on distributed file storage, which has high performance, easy deployment, easy use, and convenient data storage, and ensures data security through master-slave automatic backup.

V. DESIGN OF DATA ACCESS LAYER
In the design of the data access layer, we abandon the cumbersome and low-performance ORM framework, and adopt the lightweight SqlSugar ORM framework with high performance, which has the following advantages:

High performance: Comparable to native SQL, faster and more efficient than other ORM frameworks.
Easy to operate: More portable than other ORM frameworks such as Dapper and Entity Framework.
Support native SQL and LINQ: More flexible and elegant than other ORM frameworks such as Entity Framework.
More extensible: Its design pattern gives it unparalleled extensibility.
To improve service performance and query speed, a second-level cache based on session level is adopted, greatly improving service performance and query speed.

VI. DESIGN OF MICRO SERVICE BUSINESS SERVICE LAYER
The design of the microservice service layer is based on the service mesh technology of Linux and Kubernetes. Service mesh is the second generation of microservice technology, solving problems of the first generation of microservice technology (Spring Cloud), such as complex client development, inability to support a variety of technology stacks, inability to centralized governance, language barriers, etc.

Shielding the complexity of distributed system communication (load balancing, service discovery, authentication and authorization, monitoring and tracking, flow control, etc.), services only focus on business logic.
The service can be written in any language, just communicate with service mesh.
Transparent to applications, service mesh components can be upgraded independently.
Service mesh is a microservice technology solution very suitable for large and medium-sized business systems, with the advantage of highly automated operation and maintenance. A whole set of microservice cluster environment is built on the microservice business service layer, convenient to solve system instability caused by the complex dependency relationship between services, and provides cluster management functions such as service fault tolerance, service self-healing and health check, rolling update, etc. Each subcategory divides the business into several independent process services according to business needs, resource usage, concurrency, and many other conditions. Through the functions of service registration, service discovery, life cycle management, fault tolerance protection, and gray publishing in the cluster, centralized management of services can be realized. All services can be provided to the third-party system by web API after authorization.

VII. DISPLAY LAYER DESIGN
In the design of microservice technology architecture, the front-end is separated from the back-end, and the front-end is the MVVM (model view model) design pattern. MVVM places view and controller in the view layer, and the model layer is still the data model returned by the server. The ViewModel acts as a UI adapter, and the logic related to UI extracted from the controller is put in the ViewModel, reducing the burden of the controller.

The front-end display layer adopts the front-end page technology based on HTML5 + CSS3 + ECMAScript. The static page of HTML5 + CSS3 has advantages of fast page display speed, high page security, and high website stability. ECMAScript (ES6) is the next generation standard of JavaScript language. ECMAScript supports the browser through Babel, and the developed interface is packaged through Webpack, to generate a pure static page with the following characteristics:

Pages are confused and packaged: Package multiple files into multiple mixed files, reduce server pressure and download bandwidth, and improve response speed.
Complete precompile transformation: Convert the precompiled language into a language recognized by the browser.
Performance optimization: Webpack optimizes the page performance to make it respond faster.
Webpack is a static module bundler for modern JavaScript applications. When Webpack processes an application, it recursively builds a dependency graph that contains each module the application needs, and then packages all of these modules into one or more bundles. Webpack is like a production line, which needs to go through a series of processes before it can convert the source file into the output result. The responsibility of each process in this production line is single, and there is a dependency relationship between multiple processes. Only after the current process is completed can it be handed over to the next process. A plug-in is like a function inserted into a production line to process the resources on the production line at a specific time. Webpack organizes this complex production line through Tapable. Webpack will broadcast events in the process of running. The plug-in only needs to monitor the events it cares about and can join the production line to change the operation of the production line. The event flow mechanism of Webpack ensures the order of plug-ins and makes the whole system extensible.

VIII. MOBILE APPLICATION DESIGN
The hybrid mode of native HTML5 will be used in the design of mobile applications to realize a mobile application platform, ensuring high development efficiency and saving development time. The same set of code can be used for Android and IOS. The design and construction of the platform adopt microservice architecture. Each component supports horizontal expansion to improve service capability. In terms of data integration, it can support the integration of MES, OA, ERP, device management, PLM, and other business systems at the company and factory levels. The mobile application platform combines mobile Internet, big data, cloud computing, and other IT best practices, breaking the shackles of traditional manufacturing enterprise executive management application on the PC side through mobile extension based on existing IT systems and pure mobile Internet business and management innovation. It realizes data integration, application integration, process integration, and personnel integration between mobile applications and existing IT systems, an important measure for a new generation of technological change to promote enterprises to move towards intelligent lean management.

IX. SYSTEM SECURITY DESIGN
The security design of the system strictly abides by the relevant regulations of the information security management of the State Administration of information technology and meets the requirements of the equal security standards of the information system (identity authentication, access control, security audit, user data integrity protection, user data confidentiality protection, resource control, data backup strategies and mechanisms, intrusion prevention). From the data security, system security, and other aspects of security control mechanism to ensure the overall security of the system.

Data security design: Choose safe and stable Database Oracle and CentOS operating system. These products have perfect data backup and fault recovery mechanisms. The system can be deployed on the virtualization platform to realize the dynamic sharing of physical resources and resource pools, improving the utilization of resources. At the same time, the application can get rid of the tight coupling with the physical server through hot migration, ensuring the stability of the system, and establishing a safe and reliable MES system to ensure the smooth progress of the normal production of the enterprise.

System security design: Set reasonable access rights to the important files and resources of the server, assign user rights according to the actual positions, and grant only the minimum permissions needed for management. The privileged users of the operating system and the database system realize the separation of permissions. At the same time, limit the terminal login access mode and network address range. The login terminal has the function of timeout locking, limiting the maximum or minimum use of system resources by a single user. The system password is stored by encryption, and the complexity policy of the password can be configured dynamically.

X. CONCLUSION
Through the design and application of the microservice technology architecture of the MES system, a large number of new information technologies can be applied in the MES system, keeping up with the development of information technology in the current era, timely responding to the needs of the tobacco industry to improve the level of information application, enhancing the business processing ability and concurrency of MES in the daily use of MES information system, and solving the single point of failure problem of MES system. It can accelerate the processing speed and response performance of the system, reduce the waiting time of the page, improving the user experience, solve the security risks of the old technical architecture through the iterative upgrade of the microservice architecture, and improve the stability and reliability of the system through the multi-level design of the data storage layer, data access layer, business service layer, etc. Through the security design of identity authentication, access authorization, audit, security inter-process communication, and other aspects, the security level of the system is strengthened, better protecting the cigarette production of tobacco enterprises, fully supporting the requirements of intelligent management and intelligent manufacturing for production control, and finally realizing the construction goal of "smart factory."